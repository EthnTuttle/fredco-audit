<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frederick County Government - Efficiency Audit Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #047857 0%, #10b981 100%);
            color: white;
            padding: 40px 20px;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Navigation */
        .nav-bar {
            background: white;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-bar a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .nav-bar a:hover {
            background: var(--gray-100);
        }

        .nav-bar a.active {
            background: var(--primary);
            color: white;
        }

        .nav-bar span {
            color: var(--gray-400);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-card.highlight {
            border-left: 4px solid var(--success);
        }

        .stat-card.warning {
            border-left: 4px solid var(--warning);
        }

        .stat-card.info {
            border-left: 4px solid var(--primary-light);
        }

        .stat-card.danger {
            border-left: 4px solid var(--danger);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .stat-detail {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-top: 8px;
        }

        .stat-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Section Headers */
        .section {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray-200);
        }

        .section-header h2 {
            font-size: 1.5rem;
            color: var(--gray-800);
        }

        /* Chart Cards */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            font-size: 1.1rem;
            color: var(--gray-700);
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .chart-container.tall {
            height: 400px;
        }

        /* Tables */
        .table-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: var(--gray-50);
        }

        tr.highlight {
            background: #eff6ff;
        }

        tr.highlight:hover {
            background: #dbeafe;
        }

        /* Findings */
        .findings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .finding-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .finding-card.ok {
            border-left: 4px solid var(--success);
        }

        .finding-card.warning {
            border-left: 4px solid var(--warning);
        }

        .finding-card.info {
            border-left: 4px solid var(--primary-light);
        }

        .finding-card.critical {
            border-left: 4px solid var(--danger);
        }

        .finding-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .finding-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .finding-icon.ok {
            background: #d1fae5;
            color: #065f46;
        }

        .finding-icon.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .finding-icon.info {
            background: #dbeafe;
            color: #1e40af;
        }

        .finding-icon.critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .finding-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .finding-description {
            color: var(--gray-600);
            font-size: 0.95rem;
        }

        /* Analysis Box */
        .analysis-box {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .analysis-box h4 {
            color: #92400e;
            margin-bottom: 10px;
        }

        .analysis-box p {
            color: #78350f;
            font-size: 0.95rem;
        }

        .analysis-box.info {
            background: #eff6ff;
            border-color: #93c5fd;
        }

        .analysis-box.info h4 {
            color: #1e40af;
        }

        .analysis-box.info p {
            color: #1e3a8a;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            color: var(--gray-600);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-200);
            margin-top: 40px;
        }

        footer a {
            color: var(--primary);
        }

        /* Custom Legend */
        .custom-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Metric comparison */
        .metric-comparison {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .metric-item {
            flex: 1;
            min-width: 150px;
        }

        .metric-item label {
            font-size: 0.8rem;
            color: var(--gray-500);
            text-transform: uppercase;
        }

        .metric-item .value {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .metric-item .change {
            font-size: 0.85rem;
        }

        .change.positive {
            color: var(--danger);
        }

        .change.negative {
            color: var(--success);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Frederick County Government</h1>
            <p>Fiscal Efficiency Audit Dashboard</p>
            <p class="subtitle">Data: Frederick County Annual Budget Documents | FY2020-FY2025</p>
        </div>
    </header>

    <div class="container">
        <!-- Navigation -->
        <div class="nav-bar">
            <a href="index.html" class="active">County Government</a>
            <span>|</span>
            <a href="schools.html">School District (FCPS)</a>
        </div>

        <!-- Key Stats -->
        <section class="section">
            <div class="section-header">
                <h2>Key Metrics (FY2025)</h2>
            </div>
            <div class="stats-grid">
                <div class="stat-card info">
                    <div class="stat-label">Total Budget (All Funds)</div>
                    <div class="stat-value">$492.9M</div>
                    <div class="stat-detail">+43.5% from FY2020 ($343.4M)</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-label">General Fund</div>
                    <div class="stat-value">$255.9M</div>
                    <div class="stat-detail">+29.5% from FY2020 ($197.5M)</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-label">Per Capita Spending</div>
                    <div class="stat-value">$5,300</div>
                    <div class="stat-detail">Population ~93,000</div>
                </div>
                <div class="stat-card highlight">
                    <div class="stat-label">Admin % of Gen Fund</div>
                    <div class="stat-value">7.7%</div>
                    <div class="stat-detail">FY2024: $18.5M of $239.5M</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-label">Public Safety</div>
                    <div class="stat-value">23.6%</div>
                    <div class="stat-detail">$56.4M (FY2024 General Fund)</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-label">School Transfer</div>
                    <div class="stat-value">$130.1M</div>
                    <div class="stat-detail">51% of General Fund (FY2025)</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-label">County Employees (FT)</div>
                    <div class="stat-value">657</div>
                    <div class="stat-detail">General Fund positions (FY2024)</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-label">Real Estate Tax Rate</div>
                    <div class="stat-value">$0.51</div>
                    <div class="stat-detail">Per $100 assessed value</div>
                </div>
            </div>
        </section>

        <!-- Findings Summary -->
        <section class="section">
            <div class="section-header">
                <h2>Audit Findings</h2>
            </div>
            <div class="findings-grid">
                <div class="finding-card warning">
                    <div class="finding-header">
                        <div class="finding-icon warning">!</div>
                        <div class="finding-title">Budget Growth Exceeds Inflation</div>
                    </div>
                    <div class="finding-description">
                        Total budget grew 43.5% (FY2020-FY2025) while BLS CPI inflation was ~19%. Even using Chapwood Index (~41%), growth slightly exceeds real-world inflation.
                    </div>
                </div>
                <div class="finding-card ok">
                    <div class="finding-header">
                        <div class="finding-icon ok">&#10003;</div>
                        <div class="finding-title">Reasonable Admin Overhead</div>
                    </div>
                    <div class="finding-description">
                        General government administration at 7.7% of General Fund is within typical range for Virginia counties (5-12%).
                    </div>
                </div>
                <div class="finding-card info">
                    <div class="finding-header">
                        <div class="finding-icon info">i</div>
                        <div class="finding-title">School Share Declining</div>
                    </div>
                    <div class="finding-description">
                        School funding as % of total budget decreased from 57.2% (FY2020) to 55.0% (FY2025), though absolute funding increased 30%.
                    </div>
                </div>
                <div class="finding-card info">
                    <div class="finding-header">
                        <div class="finding-icon info">i</div>
                        <div class="finding-title">Public Safety Growth</div>
                    </div>
                    <div class="finding-description">
                        Public safety spending grew from $41.1M to $56.4M (37.4%) - slightly below overall budget growth of 43.5%.
                    </div>
                </div>
                <div class="finding-card ok">
                    <div class="finding-header">
                        <div class="finding-icon ok">&#10003;</div>
                        <div class="finding-title">Tax Rate Reduced</div>
                    </div>
                    <div class="finding-description">
                        Real estate tax rate decreased from $0.56 to $0.51 per $100 (9% reduction) while maintaining service levels, offset by property value growth.
                    </div>
                </div>
                <div class="finding-card warning">
                    <div class="finding-header">
                        <div class="finding-icon warning">!</div>
                        <div class="finding-title">Personnel Growth</div>
                    </div>
                    <div class="finding-description">
                        General Fund FT positions grew from 620 (FY2022) to 657 (FY2024) - 6% increase in 2 years. Part-time grew from 302 to 410 (36% increase).
                    </div>
                </div>
            </div>
        </section>

        <!-- Budget Growth vs Inflation -->
        <section class="section">
            <div class="section-header">
                <h2>Budget Growth vs. Inflation Analysis</h2>
            </div>
            <div class="analysis-box">
                <h4>Understanding the Inflation Comparison</h4>
                <p>
                    We compare budget growth against <strong>three inflation measures</strong> to provide perspective:
                    <strong>BLS CPI-U</strong> (official government measure, ~19% cumulative 2020-2024),
                    <strong>Truflation</strong> (real-time blockchain-based index, ~19-20%), and
                    <strong>Chapwood Index</strong> (measures actual cost of 500 items in major cities, ~41% cumulative).
                    The truth likely lies somewhere in between these measures.
                </p>
            </div>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Total Budget Growth vs. Inflation (Indexed to FY2020 = 100)</h3>
                    <div class="chart-container tall">
                        <canvas id="budgetVsInflationChart"></canvas>
                    </div>
                    <div class="custom-legend">
                        <div class="legend-item"><div class="legend-color" style="background: #1e40af"></div> Total Budget</div>
                        <div class="legend-item"><div class="legend-color" style="background: #10b981"></div> General Fund</div>
                        <div class="legend-item"><div class="legend-color" style="background: #6b7280; border: 2px dashed #6b7280; background: transparent;"></div> BLS CPI-U</div>
                        <div class="legend-item"><div class="legend-color" style="background: #f59e0b; border: 2px dashed #f59e0b; background: transparent;"></div> Truflation</div>
                        <div class="legend-item"><div class="legend-color" style="background: #dc2626; border: 2px dashed #dc2626; background: transparent;"></div> Chapwood Index</div>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Real Growth (Budget Growth Minus Inflation)</h3>
                    <div class="chart-container tall">
                        <canvas id="realGrowthChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Expenditure Breakdown -->
        <section class="section">
            <div class="section-header">
                <h2>Expenditure Breakdown (FY2025 Adopted)</h2>
            </div>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>All Funds by Category</h3>
                    <div class="chart-container tall">
                        <canvas id="expenditurePieChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>General Fund by Function (FY2024)</h3>
                    <div class="chart-container tall">
                        <canvas id="generalFundPieChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Category Trends -->
        <section class="section">
            <div class="section-header">
                <h2>Expenditure Trends by Category</h2>
            </div>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Major Categories Over Time (Adopted Budget, $ Millions)</h3>
                    <div class="chart-container tall">
                        <canvas id="categoryTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Category Growth Rates (FY2020-FY2025)</h3>
                    <div class="chart-container tall">
                        <canvas id="growthRateChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- School Funding -->
        <section class="section">
            <div class="section-header">
                <h2>School Funding Analysis</h2>
            </div>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>County Transfers to Schools</h3>
                    <div class="chart-container">
                        <canvas id="schoolTransferChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>School Funding as % of Total Budget</h3>
                    <div class="chart-container">
                        <canvas id="schoolPctChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="analysis-box info">
                <h4>School Funding Context</h4>
                <p>
                    While the school share of total budget has declined slightly (57.2% to 55.0%), absolute funding increased 
                    from $196.2M to $271.0M (+38.2%). The county's General Fund transfer to school operating increased from 
                    $86.4M to $109.0M (+26.1%). School debt service and capital transfers have remained relatively flat.
                </p>
            </div>
        </section>

        <!-- Personnel Analysis -->
        <section class="section">
            <div class="section-header">
                <h2>Personnel Analysis</h2>
            </div>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Full-Time Positions by Category (FY2022-FY2024)</h3>
                    <div class="chart-container">
                        <canvas id="personnelChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Public Safety Personnel</h3>
                    <div class="chart-container">
                        <canvas id="publicSafetyChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="table-card">
                <h3 style="margin-bottom: 15px;">Personnel Summary (Budgeted Positions)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>FY2022</th>
                            <th>FY2023</th>
                            <th>FY2024</th>
                            <th>Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>General Fund (FT)</td>
                            <td>620</td>
                            <td>637</td>
                            <td>657</td>
                            <td>+37 (+6.0%)</td>
                        </tr>
                        <tr>
                            <td>General Fund (PT)</td>
                            <td>302</td>
                            <td>402</td>
                            <td>410</td>
                            <td>+108 (+35.8%)</td>
                        </tr>
                        <tr>
                            <td>School Funds (FT)</td>
                            <td>2,387</td>
                            <td>2,453</td>
                            <td>2,473</td>
                            <td>+86 (+3.6%)</td>
                        </tr>
                        <tr>
                            <td>All Funds (FT)</td>
                            <td>3,278</td>
                            <td>3,363</td>
                            <td>3,404</td>
                            <td>+126 (+3.8%)</td>
                        </tr>
                        <tr class="highlight">
                            <td><strong>Sheriff</strong></td>
                            <td>157.5</td>
                            <td>157.5</td>
                            <td>164.5</td>
                            <td>+7 (+4.4%)</td>
                        </tr>
                        <tr class="highlight">
                            <td><strong>Fire & Rescue</strong></td>
                            <td>153.5</td>
                            <td>161.5</td>
                            <td>169.5</td>
                            <td>+16 (+10.4%)</td>
                        </tr>
                        <tr class="highlight">
                            <td><strong>Regional Jail</strong></td>
                            <td>213</td>
                            <td>213</td>
                            <td>213</td>
                            <td>0 (0%)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Department-Level Analysis (NEW) -->
        <section class="section">
            <div class="section-header">
                <h2>Department-Level Analysis</h2>
            </div>
            <div class="analysis-box info">
                <h4>Granular Budget Data</h4>
                <p>
                    This section provides detailed expenditure and personnel data at the individual department level,
                    extracted from Frederick County's comprehensive annual budget documents. Data shows Personnel costs,
                    Operating expenses, and Capital expenditures for each department.
                </p>
            </div>
            
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Top 15 Departments by Total Expenditure (FY2025)</h3>
                    <div class="chart-container tall">
                        <canvas id="deptExpenseChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Personnel Growth by Department (FY2022-FY2026)</h3>
                    <div class="chart-container tall">
                        <canvas id="deptPersonnelGrowthChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Public Safety Spending Breakdown (FY2025)</h3>
                    <div class="chart-container">
                        <canvas id="publicSafetyBreakdownChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Fire & Rescue vs Sheriff Staffing Trend</h3>
                    <div class="chart-container">
                        <canvas id="publicSafetyTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="table-card">
                <h3 style="margin-bottom: 15px;">General Fund Expenditures by Department (FY2025 Adopted) - $256.3M Total</h3>
                <table id="deptDetailTable">
                    <thead>
                        <tr>
                            <th>Category / Department</th>
                            <th>Personnel</th>
                            <th>Operating</th>
                            <th>Capital</th>
                            <th>Total</th>
                            <th>% of GF</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Transfers Section -->
                        <tr class="highlight" style="background: #dbeafe;">
                            <td colspan="6"><strong>Transfers & Non-Departmental (54.3%)</strong></td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Transfer to School Operating</td>
                            <td>-</td>
                            <td>$109,016,000</td>
                            <td>-</td>
                            <td>$109,016,000</td>
                            <td>42.5%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Transfer to School Debt Service</td>
                            <td>-</td>
                            <td>$20,460,000</td>
                            <td>-</td>
                            <td>$20,460,000</td>
                            <td>8.0%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Transfer to School Capital</td>
                            <td>-</td>
                            <td>$4,000,000</td>
                            <td>-</td>
                            <td>$4,000,000</td>
                            <td>1.6%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Debt Service, Contingency, Reserves</td>
                            <td>-</td>
                            <td>$5,713,000</td>
                            <td>-</td>
                            <td>$5,713,000</td>
                            <td>2.2%</td>
                        </tr>
                        <tr style="font-weight: 600; background: #eff6ff;">
                            <td style="padding-left: 12px;"><em>Subtotal Transfers</em></td>
                            <td>-</td>
                            <td>$139,189,000</td>
                            <td>-</td>
                            <td>$139,189,000</td>
                            <td>54.3%</td>
                        </tr>

                        <!-- Public Safety -->
                        <tr class="highlight" style="background: #fee2e2;">
                            <td colspan="6"><strong>Public Safety (19.5%)</strong></td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Fire and Rescue</td>
                            <td>$21,751,000</td>
                            <td>$2,206,000</td>
                            <td>$251,000</td>
                            <td>$24,209,000</td>
                            <td>9.4%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Sheriff</td>
                            <td>$18,977,000</td>
                            <td>$2,784,000</td>
                            <td>$885,000</td>
                            <td>$22,646,000</td>
                            <td>8.8%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Public Safety Communications</td>
                            <td>$1,964,000</td>
                            <td>$657,000</td>
                            <td>$124,000</td>
                            <td>$2,745,000</td>
                            <td>1.1%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Inspections</td>
                            <td>$1,587,000</td>
                            <td>$91,000</td>
                            <td>$3,000</td>
                            <td>$1,681,000</td>
                            <td>0.7%</td>
                        </tr>
                        <tr style="font-weight: 600; background: #fef2f2;">
                            <td style="padding-left: 12px;"><em>Subtotal Public Safety</em></td>
                            <td>$44,279,000</td>
                            <td>$5,738,000</td>
                            <td>$1,263,000</td>
                            <td>$51,281,000</td>
                            <td>20.0%</td>
                        </tr>

                        <!-- Health & Welfare -->
                        <tr class="highlight" style="background: #d1fae5;">
                            <td colspan="6"><strong>Health & Welfare (5.4%)</strong></td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Social Services (Admin)</td>
                            <td>$8,764,000</td>
                            <td>$602,000</td>
                            <td>$296,000</td>
                            <td>$9,662,000</td>
                            <td>3.8%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Public Assistance Programs</td>
                            <td>-</td>
                            <td>$2,100,000</td>
                            <td>-</td>
                            <td>$2,100,000</td>
                            <td>0.8%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Health Dept & Other</td>
                            <td>-</td>
                            <td>$2,000,000</td>
                            <td>-</td>
                            <td>$2,000,000</td>
                            <td>0.8%</td>
                        </tr>
                        <tr style="font-weight: 600; background: #ecfdf5;">
                            <td style="padding-left: 12px;"><em>Subtotal Health & Welfare</em></td>
                            <td>$8,764,000</td>
                            <td>$4,702,000</td>
                            <td>$296,000</td>
                            <td>$13,762,000</td>
                            <td>5.4%</td>
                        </tr>

                        <!-- Administration -->
                        <tr class="highlight" style="background: #f3f4f6;">
                            <td colspan="6"><strong>General Government Administration (7.7%)</strong></td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Information Technology</td>
                            <td>$1,352,000</td>
                            <td>$472,000</td>
                            <td>$1,024,000</td>
                            <td>$2,849,000</td>
                            <td>1.1%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Treasurer</td>
                            <td>$1,590,000</td>
                            <td>$674,000</td>
                            <td>$1,000</td>
                            <td>$2,266,000</td>
                            <td>0.9%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Commissioner of Revenue</td>
                            <td>$1,966,000</td>
                            <td>$119,000</td>
                            <td>$6,000</td>
                            <td>$2,091,000</td>
                            <td>0.8%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">County Office Buildings</td>
                            <td>-</td>
                            <td>$1,880,000</td>
                            <td>$3,000</td>
                            <td>$1,882,000</td>
                            <td>0.7%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Finance</td>
                            <td>$1,288,000</td>
                            <td>$35,000</td>
                            <td>-</td>
                            <td>$1,323,000</td>
                            <td>0.5%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">County Administrator</td>
                            <td>$1,144,000</td>
                            <td>$47,000</td>
                            <td>-</td>
                            <td>$1,191,000</td>
                            <td>0.5%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Human Resources</td>
                            <td>$736,000</td>
                            <td>$426,000</td>
                            <td>$5,000</td>
                            <td>$1,167,000</td>
                            <td>0.5%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Other Admin Departments</td>
                            <td>$2,500,000</td>
                            <td>$4,500,000</td>
                            <td>$30,000</td>
                            <td>$7,030,000</td>
                            <td>2.7%</td>
                        </tr>
                        <tr style="font-weight: 600; background: #f9fafb;">
                            <td style="padding-left: 12px;"><em>Subtotal Administration</em></td>
                            <td>$10,576,000</td>
                            <td>$8,153,000</td>
                            <td>$1,069,000</td>
                            <td>$19,799,000</td>
                            <td>7.7%</td>
                        </tr>

                        <!-- Parks & Recreation -->
                        <tr class="highlight" style="background: #ccfbf1;">
                            <td colspan="6"><strong>Parks, Recreation & Cultural (4.0%)</strong></td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Recreation Centers</td>
                            <td>$3,372,000</td>
                            <td>$1,020,000</td>
                            <td>-</td>
                            <td>$4,392,000</td>
                            <td>1.7%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Parks (Admin + Sites)</td>
                            <td>$2,500,000</td>
                            <td>$1,600,000</td>
                            <td>$200,000</td>
                            <td>$4,300,000</td>
                            <td>1.7%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Regional Library</td>
                            <td>-</td>
                            <td>$1,500,000</td>
                            <td>-</td>
                            <td>$1,500,000</td>
                            <td>0.6%</td>
                        </tr>
                        <tr style="font-weight: 600; background: #f0fdfa;">
                            <td style="padding-left: 12px;"><em>Subtotal Parks/Rec/Cultural</em></td>
                            <td>$5,872,000</td>
                            <td>$4,120,000</td>
                            <td>$200,000</td>
                            <td>$10,192,000</td>
                            <td>4.0%</td>
                        </tr>

                        <!-- Other Categories -->
                        <tr class="highlight" style="background: #fef3c7;">
                            <td colspan="6"><strong>Other (9.1%)</strong></td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Judicial Administration</td>
                            <td>$3,400,000</td>
                            <td>$500,000</td>
                            <td>$30,000</td>
                            <td>$3,930,000</td>
                            <td>1.5%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Public Works</td>
                            <td>$2,300,000</td>
                            <td>$4,600,000</td>
                            <td>$250,000</td>
                            <td>$7,150,000</td>
                            <td>2.8%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Community Development</td>
                            <td>$1,500,000</td>
                            <td>$600,000</td>
                            <td>-</td>
                            <td>$2,100,000</td>
                            <td>0.8%</td>
                        </tr>
                        <tr>
                            <td style="padding-left: 24px;">Miscellaneous & Other</td>
                            <td>$3,600,000</td>
                            <td>$6,300,000</td>
                            <td>$100,000</td>
                            <td>$10,000,000</td>
                            <td>3.9%</td>
                        </tr>
                        <tr style="font-weight: 600; background: #fef9c3;">
                            <td style="padding-left: 12px;"><em>Subtotal Other</em></td>
                            <td>$10,800,000</td>
                            <td>$12,000,000</td>
                            <td>$380,000</td>
                            <td>$23,180,000</td>
                            <td>9.0%</td>
                        </tr>

                        <!-- Grand Total -->
                        <tr style="font-weight: 700; background: #1e40af; color: white;">
                            <td>GENERAL FUND TOTAL</td>
                            <td>$80,291,000</td>
                            <td>$173,902,000</td>
                            <td>$3,208,000</td>
                            <td>$256,303,000</td>
                            <td>100.0%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-card" style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px;">Other Funds (Outside General Fund)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Fund</th>
                            <th>Personnel</th>
                            <th>Operating</th>
                            <th>Capital</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Regional Jail</td>
                            <td>$22,067,000</td>
                            <td>$7,169,000</td>
                            <td>$180,000</td>
                            <td>$29,416,000</td>
                        </tr>
                        <tr>
                            <td>Landfill (Enterprise)</td>
                            <td>$2,986,000</td>
                            <td>$4,573,000</td>
                            <td>$4,284,000</td>
                            <td>$11,843,000</td>
                        </tr>
                        <tr>
                            <td>Regional Airport</td>
                            <td>$1,123,000</td>
                            <td>$1,967,000</td>
                            <td>$92,000</td>
                            <td>$3,182,000</td>
                        </tr>
                        <tr>
                            <td>EMS Revenue Recovery</td>
                            <td>$200,000</td>
                            <td>$2,400,000</td>
                            <td>$200,000</td>
                            <td>$2,800,000</td>
                        </tr>
                        <tr>
                            <td>Other Special Revenue Funds</td>
                            <td>$1,200,000</td>
                            <td>$2,500,000</td>
                            <td>$300,000</td>
                            <td>$4,000,000</td>
                        </tr>
                        <tr style="font-weight: 600; background: #f3f4f6;">
                            <td>Total Other Funds</td>
                            <td>$27,576,000</td>
                            <td>$18,609,000</td>
                            <td>$5,056,000</td>
                            <td>$51,241,000</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-card" style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px;">Personnel by Department (Full-Time Positions)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Department</th>
                            <th>FY2022</th>
                            <th>FY2023</th>
                            <th>FY2024</th>
                            <th>FY2025</th>
                            <th>FY2026</th>
                            <th>4-Year Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="highlight">
                            <td><strong>Fire and Rescue</strong></td>
                            <td>153.5</td>
                            <td>161.5</td>
                            <td>169.5</td>
                            <td>185.5</td>
                            <td>193.5</td>
                            <td><span style="color: #dc2626;">+40 (+26.1%)</span></td>
                        </tr>
                        <tr class="highlight">
                            <td><strong>Sheriff</strong></td>
                            <td>157.5</td>
                            <td>157.5</td>
                            <td>164.5</td>
                            <td>168.5</td>
                            <td>171.5</td>
                            <td><span style="color: #dc2626;">+14 (+8.9%)</span></td>
                        </tr>
                        <tr>
                            <td>Social Services</td>
                            <td>83.0</td>
                            <td>84.0</td>
                            <td>87.0</td>
                            <td>90.0</td>
                            <td>88.0</td>
                            <td>+5 (+6.0%)</td>
                        </tr>
                        <tr>
                            <td>Parks and Recreation</td>
                            <td>42.0</td>
                            <td>43.0</td>
                            <td>43.0</td>
                            <td>43.0</td>
                            <td>43.0</td>
                            <td>+1 (+2.4%)</td>
                        </tr>
                        <tr>
                            <td>COR/Reassessment</td>
                            <td>24.0</td>
                            <td>25.0</td>
                            <td>25.0</td>
                            <td>25.0</td>
                            <td>25.0</td>
                            <td>+1 (+4.2%)</td>
                        </tr>
                        <tr>
                            <td>Public Safety Communications</td>
                            <td>17.0</td>
                            <td>19.0</td>
                            <td>20.0</td>
                            <td>22.0</td>
                            <td>22.0</td>
                            <td>+5 (+29.4%)</td>
                        </tr>
                        <tr>
                            <td>Commonwealth Attorney</td>
                            <td>16.0</td>
                            <td>16.0</td>
                            <td>17.0</td>
                            <td>18.0</td>
                            <td>18.0</td>
                            <td>+2 (+12.5%)</td>
                        </tr>
                        <tr>
                            <td>Inspections</td>
                            <td>17.0</td>
                            <td>17.0</td>
                            <td>17.0</td>
                            <td>17.0</td>
                            <td>17.0</td>
                            <td>0 (0%)</td>
                        </tr>
                        <tr>
                            <td>IT/MIS</td>
                            <td>16.0</td>
                            <td>16.0</td>
                            <td>16.0</td>
                            <td>16.0</td>
                            <td>16.0</td>
                            <td>0 (0%)</td>
                        </tr>
                        <tr>
                            <td>Planning and Development</td>
                            <td>11.0</td>
                            <td>12.0</td>
                            <td>12.0</td>
                            <td>12.0</td>
                            <td>12.0</td>
                            <td>+1 (+9.1%)</td>
                        </tr>
                        <tr>
                            <td>Maintenance</td>
                            <td>10.0</td>
                            <td>10.0</td>
                            <td>11.0</td>
                            <td>11.0</td>
                            <td>11.0</td>
                            <td>+1 (+10.0%)</td>
                        </tr>
                        <tr>
                            <td>Regional Jail</td>
                            <td>213.0</td>
                            <td>213.0</td>
                            <td>213.0</td>
                            <td>215.0</td>
                            <td>219.0</td>
                            <td>+6 (+2.8%)</td>
                        </tr>
                        <tr style="font-weight: bold; background: #f3f4f6;">
                            <td>General Fund Total (FT)</td>
                            <td>620</td>
                            <td>637</td>
                            <td>657</td>
                            <td>681</td>
                            <td>695</td>
                            <td>+75 (+12.1%)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Tax Rate Comparison -->
        <section class="section">
            <div class="section-header">
                <h2>Tax Rates</h2>
            </div>
            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Real Estate Tax Rate (per $100 assessed value)</h3>
                    <div class="chart-container">
                        <canvas id="taxRateChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Personal Property Tax Rate (per $100)</h3>
                    <div class="chart-container">
                        <canvas id="ppTaxRateChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Per Capita Analysis -->
        <section class="section">
            <div class="section-header">
                <h2>Per Capita Analysis</h2>
            </div>
            <div class="table-card">
                <h3 style="margin-bottom: 15px;">Per Capita Spending by Category (FY2024, Population ~93,000)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Per Capita</th>
                            <th>% of General Fund</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>General Fund Total</td>
                            <td>$239.5M</td>
                            <td>$2,575</td>
                            <td>100%</td>
                        </tr>
                        <tr>
                            <td>Public Safety</td>
                            <td>$56.4M</td>
                            <td>$607</td>
                            <td>23.6%</td>
                        </tr>
                        <tr>
                            <td>General Gov't Admin</td>
                            <td>$18.5M</td>
                            <td>$199</td>
                            <td>7.7%</td>
                        </tr>
                        <tr>
                            <td>Health & Welfare</td>
                            <td>$12.9M</td>
                            <td>$139</td>
                            <td>5.4%</td>
                        </tr>
                        <tr>
                            <td>Parks & Recreation</td>
                            <td>$10.0M</td>
                            <td>$107</td>
                            <td>4.2%</td>
                        </tr>
                        <tr>
                            <td>Public Works</td>
                            <td>$7.3M</td>
                            <td>$79</td>
                            <td>3.1%</td>
                        </tr>
                        <tr>
                            <td>Judicial Admin</td>
                            <td>$3.7M</td>
                            <td>$40</td>
                            <td>1.5%</td>
                        </tr>
                        <tr>
                            <td>Community Development</td>
                            <td>$2.6M</td>
                            <td>$28</td>
                            <td>1.1%</td>
                        </tr>
                        <tr class="highlight">
                            <td><strong>Transfer to Schools</strong></td>
                            <td><strong>$122.1M</strong></td>
                            <td><strong>$1,313</strong></td>
                            <td><strong>51.0%</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Data Sources -->
        <section class="section">
            <div class="section-header">
                <h2>Data Sources & Methodology</h2>
            </div>
            <div class="table-card">
                <h3 style="margin-bottom: 16px;">Primary Data Sources</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Source</th>
                            <th>Data</th>
                            <th>Years</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><a href="https://www.fcva.us/departments/finance/budget" target="_blank">Frederick County Budget Documents</a></td>
                            <td>Annual adopted budgets, expenditures by category, personnel counts</td>
                            <td>FY2020-FY2026</td>
                        </tr>
                        <tr>
                            <td><a href="https://www.bls.gov/cpi/" target="_blank">Bureau of Labor Statistics</a></td>
                            <td>Consumer Price Index (CPI-U)</td>
                            <td>2020-2024</td>
                        </tr>
                        <tr>
                            <td><a href="https://truflation.com/" target="_blank">Truflation</a></td>
                            <td>Real-time inflation index</td>
                            <td>2020-2024</td>
                        </tr>
                        <tr>
                            <td><a href="http://www.chapwoodindex.org/" target="_blank">Chapwood Index</a></td>
                            <td>Alternative inflation measure (500 items)</td>
                            <td>2020-2024</td>
                        </tr>
                    </tbody>
                </table>

                <h3 style="margin: 24px 0 16px;">Methodology Notes</h3>
                <ul style="padding-left: 20px; color: var(--gray-600);">
                    <li>All dollar figures are from adopted budgets unless noted as "actual"</li>
                    <li>Population estimate of 93,000 used for per-capita calculations (2024 estimate)</li>
                    <li>Personnel counts are budgeted FTE positions, not actual headcount</li>
                    <li>Inflation indices are cumulative from January 2020 baseline</li>
                    <li>"All Funds" includes General Fund, School Funds, Enterprise Funds (Landfill), and Special Revenue Funds</li>
                </ul>
            </div>
        </section>
    </div>

    <footer>
        <p>Frederick County Government Efficiency Audit Dashboard | Data analysis performed January 2026</p>
        <p>Source: <a href="https://www.fcva.us/departments/finance/budget" target="_blank">Frederick County Finance Department</a></p>
    </footer>

    <script>
        // Color palette
        const colors = {
            primary: '#1e40af',
            primaryLight: '#3b82f6',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
            purple: '#8b5cf6',
            pink: '#ec4899',
            gray: '#6b7280',
            teal: '#14b8a6',
            orange: '#f97316',
            indigo: '#6366f1',
        };

        // Fiscal years
        const years = ['FY2020', 'FY2021', 'FY2022', 'FY2023', 'FY2024', 'FY2025'];
        const yearLabels = ['FY2020', 'FY2021', 'FY2022', 'FY2023', 'FY2024', 'FY2025'];

        // Budget data from county_government_analysis.json
        const budgetData = {
            totalBudget: [343.4, 355.6, 371.2, 425.6, 439.1, 492.9],
            generalFund: [197.5, 206.5, 209.7, 232.5, 239.5, 255.9],
        };

        // Expenditures by category (adopted amounts from JSON, in millions)
        const expendituresByCategory = {
            schoolFunds: [196.2, 203.3, 216.3, 248.2, 256.9, 271.0],
            publicSafety: [32.2, 36.8, 40.7, 44.2, 49.2, 53.8],
            regionalJail: [21.9, 21.9, 25.6, 27.3, 28.9, 29.4],
            healthWelfare: [9.4, 9.7, 11.7, 12.5, 12.9, 13.6],
            parksRec: [8.6, 7.1, 8.2, 9.2, 10.0, 10.2],
            publicWorks: [5.5, 5.5, 6.3, 6.8, 7.3, 7.1],
            landfill: [9.4, 8.5, 11.3, 13.2, 10.3, 11.8],
            generalAdmin: [2.7, 2.8, 3.1, 3.3, 3.7, 3.9],
            judicialAdmin: [2.7, 2.8, 3.1, 3.3, 3.7, 3.9],
            communityDev: [1.5, 1.5, 1.6, 1.8, 1.9, 2.1],
            miscellaneous: [2.3, 2.3, 5.9, 9.0, 5.9, 11.4],
        };

        // General Fund breakdown (FY2024)
        const generalFundFY24 = {
            publicSafety: 56.4,
            adminOverhead: 18.5,
            healthWelfare: 12.9,
            parksRec: 10.0,
            publicWorks: 7.3,
            judicialAdmin: 3.7,
            communityDev: 2.6,
        };

        // School transfers
        const schoolTransfers = {
            operating: [86.4, 91.4, 92.9, 95.5, 104.0, 109.0],
            debtService: [16.2, 17.1, 18.1, 18.1, 18.1, 18.1],
            capital: [4.0, 3.7, 0, 0, 0, 3.0],
        };

        // Personnel data (FY2022-FY2024 only)
        const personnelYears = ['FY2022', 'FY2023', 'FY2024'];
        const personnelData = {
            generalFundFT: [620, 637, 657],
            generalFundPT: [302, 402, 410],
            schoolFundsFT: [2387, 2453, 2473],
            sheriffFT: [157.5, 157.5, 164.5],
            fireRescueFT: [153.5, 161.5, 169.5],
            jailFT: [213, 213, 213],
        };

        // Tax rates
        const taxRates = {
            realEstate: [0.56, 0.56, 0.61, 0.61, 0.51, 0.51],
            personalProperty: [4.86, 4.86, 4.86, 4.23, 4.23, 4.23],
        };

        // Inflation indices (cumulative from 2020 baseline = 100)
        const inflationData = {
            blsCPI: [100, 101.4, 108.5, 113.0, 117.1, 119.0],
            truflation: [100, 101.5, 109.0, 114.0, 118.0, 120.0],
            chapwood: [100, 108.0, 118.0, 128.0, 138.0, 141.0],
        };

        // Indexed budget data (FY2020 = 100)
        const indexedBudget = budgetData.totalBudget.map(v => (v / budgetData.totalBudget[0]) * 100);
        const indexedGeneralFund = budgetData.generalFund.map(v => (v / budgetData.generalFund[0]) * 100);

        // 1. Budget vs Inflation Chart
        new Chart(document.getElementById('budgetVsInflationChart'), {
            type: 'line',
            data: {
                labels: yearLabels,
                datasets: [
                    {
                        label: 'Total Budget',
                        data: indexedBudget,
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '20',
                        fill: false,
                        borderWidth: 3,
                        tension: 0.3,
                    },
                    {
                        label: 'General Fund',
                        data: indexedGeneralFund,
                        borderColor: colors.success,
                        backgroundColor: colors.success + '20',
                        fill: false,
                        borderWidth: 3,
                        tension: 0.3,
                    },
                    {
                        label: 'BLS CPI-U',
                        data: inflationData.blsCPI,
                        borderColor: colors.gray,
                        borderDash: [5, 5],
                        fill: false,
                        borderWidth: 2,
                        tension: 0.3,
                    },
                    {
                        label: 'Truflation',
                        data: inflationData.truflation,
                        borderColor: colors.warning,
                        borderDash: [5, 5],
                        fill: false,
                        borderWidth: 2,
                        tension: 0.3,
                    },
                    {
                        label: 'Chapwood Index',
                        data: inflationData.chapwood,
                        borderColor: colors.danger,
                        borderDash: [5, 5],
                        fill: false,
                        borderWidth: 2,
                        tension: 0.3,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw.toFixed(1)} (${(ctx.raw - 100).toFixed(1)}% from baseline)`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 95,
                        max: 155,
                        title: { display: true, text: 'Index (FY2020 = 100)' }
                    }
                }
            }
        });

        // 2. Real Growth Chart
        const realGrowthBLS = indexedBudget.map((v, i) => v - inflationData.blsCPI[i]);
        const realGrowthTruflation = indexedBudget.map((v, i) => v - inflationData.truflation[i]);
        const realGrowthChapwood = indexedBudget.map((v, i) => v - inflationData.chapwood[i]);

        new Chart(document.getElementById('realGrowthChart'), {
            type: 'bar',
            data: {
                labels: yearLabels,
                datasets: [
                    {
                        label: 'vs BLS CPI',
                        data: realGrowthBLS,
                        backgroundColor: colors.primary,
                    },
                    {
                        label: 'vs Truflation',
                        data: realGrowthTruflation,
                        backgroundColor: colors.warning,
                    },
                    {
                        label: 'vs Chapwood',
                        data: realGrowthChapwood,
                        backgroundColor: colors.danger,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw > 0 ? '+' : ''}${ctx.raw.toFixed(1)}% real growth`
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Real Growth (percentage points above inflation)' }
                    }
                }
            }
        });

        // 3. Expenditure Pie Chart (FY2025 All Funds)
        new Chart(document.getElementById('expenditurePieChart'), {
            type: 'doughnut',
            data: {
                labels: ['School Funds', 'Public Safety', 'Regional Jail', 'Landfill', 'Health & Welfare', 'Parks & Rec', 'Public Works', 'Admin & Other'],
                datasets: [{
                    data: [271.0, 53.8, 29.4, 11.8, 13.6, 10.2, 7.1, 20.1],
                    backgroundColor: [
                        colors.primary,
                        colors.danger,
                        colors.orange,
                        colors.purple,
                        colors.success,
                        colors.teal,
                        colors.warning,
                        colors.gray,
                    ],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => {
                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                const pct = ((ctx.raw / total) * 100).toFixed(1);
                                return `${ctx.label}: $${ctx.raw}M (${pct}%)`;
                            }
                        }
                    }
                }
            }
        });

        // 4. General Fund Pie Chart (FY2024)
        new Chart(document.getElementById('generalFundPieChart'), {
            type: 'doughnut',
            data: {
                labels: ['Public Safety', 'Admin Overhead', 'Health & Welfare', 'Parks & Rec', 'Public Works', 'Judicial Admin', 'Community Dev', 'Transfer to Schools'],
                datasets: [{
                    data: [56.4, 18.5, 12.9, 10.0, 7.3, 3.7, 2.6, 122.1],
                    backgroundColor: [
                        colors.danger,
                        colors.gray,
                        colors.success,
                        colors.teal,
                        colors.warning,
                        colors.purple,
                        colors.pink,
                        colors.primary,
                    ],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => {
                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                const pct = ((ctx.raw / total) * 100).toFixed(1);
                                return `${ctx.label}: $${ctx.raw}M (${pct}%)`;
                            }
                        }
                    }
                }
            }
        });

        // 5. Category Trend Chart
        new Chart(document.getElementById('categoryTrendChart'), {
            type: 'line',
            data: {
                labels: yearLabels,
                datasets: [
                    {
                        label: 'School Funds',
                        data: expendituresByCategory.schoolFunds,
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '20',
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Public Safety',
                        data: expendituresByCategory.publicSafety,
                        borderColor: colors.danger,
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Regional Jail',
                        data: expendituresByCategory.regionalJail,
                        borderColor: colors.orange,
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Health & Welfare',
                        data: expendituresByCategory.healthWelfare,
                        borderColor: colors.success,
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Parks & Rec',
                        data: expendituresByCategory.parksRec,
                        borderColor: colors.teal,
                        fill: false,
                        tension: 0.3,
                    },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: $${ctx.raw.toFixed(1)}M`
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Millions ($)' }
                    }
                }
            }
        });

        // 6. Growth Rate Chart
        const calculateGrowth = (arr) => ((arr[arr.length - 1] - arr[0]) / arr[0] * 100).toFixed(1);
        const growthRates = [
            { label: 'Total Budget', value: 43.5, color: colors.primary },
            { label: 'School Funds', value: parseFloat(calculateGrowth(expendituresByCategory.schoolFunds)), color: colors.primaryLight },
            { label: 'Public Safety', value: parseFloat(calculateGrowth(expendituresByCategory.publicSafety)), color: colors.danger },
            { label: 'Regional Jail', value: parseFloat(calculateGrowth(expendituresByCategory.regionalJail)), color: colors.orange },
            { label: 'Health & Welfare', value: parseFloat(calculateGrowth(expendituresByCategory.healthWelfare)), color: colors.success },
            { label: 'Parks & Rec', value: parseFloat(calculateGrowth(expendituresByCategory.parksRec)), color: colors.teal },
            { label: 'BLS CPI (ref)', value: 19.0, color: colors.gray },
            { label: 'Chapwood (ref)', value: 41.0, color: colors.gray },
        ];

        new Chart(document.getElementById('growthRateChart'), {
            type: 'bar',
            data: {
                labels: growthRates.map(r => r.label),
                datasets: [{
                    data: growthRates.map(r => r.value),
                    backgroundColor: growthRates.map(r => r.color),
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.raw}% growth (FY2020-FY2025)`
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Growth %' }
                    }
                }
            }
        });

        // 7. School Transfer Chart
        new Chart(document.getElementById('schoolTransferChart'), {
            type: 'bar',
            data: {
                labels: yearLabels,
                datasets: [
                    {
                        label: 'Operating',
                        data: schoolTransfers.operating,
                        backgroundColor: colors.primary,
                    },
                    {
                        label: 'Debt Service',
                        data: schoolTransfers.debtService,
                        backgroundColor: colors.warning,
                    },
                    {
                        label: 'Capital',
                        data: schoolTransfers.capital,
                        backgroundColor: colors.success,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: $${ctx.raw.toFixed(1)}M`
                        }
                    }
                },
                scales: {
                    x: { stacked: true },
                    y: { 
                        stacked: true,
                        title: { display: true, text: 'Millions ($)' }
                    }
                }
            }
        });

        // 8. School % of Budget Chart
        const schoolPct = expendituresByCategory.schoolFunds.map((s, i) => (s / budgetData.totalBudget[i] * 100).toFixed(1));
        
        new Chart(document.getElementById('schoolPctChart'), {
            type: 'line',
            data: {
                labels: yearLabels,
                datasets: [{
                    label: 'School Funds % of Total Budget',
                    data: schoolPct,
                    borderColor: colors.primary,
                    backgroundColor: colors.primary + '30',
                    fill: true,
                    tension: 0.3,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.raw}% of total budget`
                        }
                    }
                },
                scales: {
                    y: {
                        min: 50,
                        max: 60,
                        title: { display: true, text: 'Percentage' }
                    }
                }
            }
        });

        // 9. Personnel Chart
        new Chart(document.getElementById('personnelChart'), {
            type: 'bar',
            data: {
                labels: personnelYears,
                datasets: [
                    {
                        label: 'General Fund FT',
                        data: personnelData.generalFundFT,
                        backgroundColor: colors.primary,
                    },
                    {
                        label: 'General Fund PT',
                        data: personnelData.generalFundPT,
                        backgroundColor: colors.primaryLight,
                    },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Positions' }
                    }
                }
            }
        });

        // 10. Public Safety Personnel Chart
        new Chart(document.getElementById('publicSafetyChart'), {
            type: 'bar',
            data: {
                labels: personnelYears,
                datasets: [
                    {
                        label: 'Sheriff',
                        data: personnelData.sheriffFT,
                        backgroundColor: colors.danger,
                    },
                    {
                        label: 'Fire & Rescue',
                        data: personnelData.fireRescueFT,
                        backgroundColor: colors.orange,
                    },
                    {
                        label: 'Regional Jail',
                        data: personnelData.jailFT,
                        backgroundColor: colors.purple,
                    },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                },
                scales: {
                    y: {
                        title: { display: true, text: 'FT Positions' }
                    }
                }
            }
        });

        // 11. Real Estate Tax Rate Chart
        new Chart(document.getElementById('taxRateChart'), {
            type: 'line',
            data: {
                labels: yearLabels,
                datasets: [{
                    label: 'Real Estate Tax Rate',
                    data: taxRates.realEstate,
                    borderColor: colors.success,
                    backgroundColor: colors.success + '30',
                    fill: true,
                    tension: 0.3,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `$${ctx.raw} per $100`
                        }
                    }
                },
                scales: {
                    y: {
                        min: 0.4,
                        max: 0.7,
                        title: { display: true, text: '$ per $100 assessed value' }
                    }
                }
            }
        });

        // 12. Personal Property Tax Rate Chart
        new Chart(document.getElementById('ppTaxRateChart'), {
            type: 'line',
            data: {
                labels: yearLabels,
                datasets: [{
                    label: 'Personal Property Tax Rate',
                    data: taxRates.personalProperty,
                    borderColor: colors.warning,
                    backgroundColor: colors.warning + '30',
                    fill: true,
                    tension: 0.3,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `$${ctx.raw} per $100`
                        }
                    }
                },
                scales: {
                    y: {
                        min: 3.5,
                        max: 5.5,
                        title: { display: true, text: '$ per $100 assessed value' }
                    }
                }
            }
        });

        // === NEW DEPARTMENT-LEVEL CHARTS ===

        // Department expenditure data (FY2025)
        const deptExpenses = [
            { name: 'Fire and Rescue', total: 24.2, personnel: 21.3, operating: 2.8, capital: 0.1 },
            { name: 'Sheriff', total: 22.6, personnel: 19.5, operating: 3.1, capital: 0.05 },
            { name: 'Regional Jail', total: 29.4, personnel: 22.1, operating: 7.2, capital: 0.2 },
            { name: 'Landfill', total: 11.8, personnel: 3.0, operating: 4.6, capital: 4.3 },
            { name: 'Social Services', total: 9.7, personnel: 8.8, operating: 0.6, capital: 0.3 },
            { name: 'Recreation Centers', total: 5.0, personnel: 3.9, operating: 1.1, capital: 0 },
            { name: 'Information Technology', total: 3.9, personnel: 1.5, operating: 2.3, capital: 0.1 },
            { name: 'Regional Airport', total: 3.2, personnel: 1.1, operating: 2.0, capital: 0.1 },
            { name: 'Public Safety Comms', total: 3.0, personnel: 2.2, operating: 0.8, capital: 0.02 },
            { name: 'Treasurer', total: 2.3, personnel: 1.6, operating: 0.7, capital: 0 },
            { name: 'Commissioner of Rev', total: 2.1, personnel: 2.0, operating: 0.1, capital: 0 },
            { name: 'Commonwealth Attorney', total: 2.3, personnel: 2.2, operating: 0.1, capital: 0.01 },
            { name: 'Planning & Dev', total: 1.5, personnel: 1.4, operating: 0.2, capital: 0 },
            { name: 'Finance', total: 1.3, personnel: 1.3, operating: 0.04, capital: 0 },
            { name: 'County Administrator', total: 1.2, personnel: 1.1, operating: 0.05, capital: 0 },
        ];

        // 13. Department Expense Chart
        new Chart(document.getElementById('deptExpenseChart'), {
            type: 'bar',
            data: {
                labels: deptExpenses.map(d => d.name),
                datasets: [
                    {
                        label: 'Personnel',
                        data: deptExpenses.map(d => d.personnel),
                        backgroundColor: colors.primary,
                    },
                    {
                        label: 'Operating',
                        data: deptExpenses.map(d => d.operating),
                        backgroundColor: colors.warning,
                    },
                    {
                        label: 'Capital',
                        data: deptExpenses.map(d => d.capital),
                        backgroundColor: colors.success,
                    },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: $${ctx.raw.toFixed(1)}M`
                        }
                    }
                },
                scales: {
                    x: { 
                        stacked: true,
                        title: { display: true, text: 'Millions ($)' }
                    },
                    y: { stacked: true }
                }
            }
        });

        // Personnel growth data (FY2022-FY2026)
        const personnelYearsExtended = ['FY2022', 'FY2023', 'FY2024', 'FY2025', 'FY2026'];
        const personnelGrowth = {
            'Fire and Rescue': [153.5, 161.5, 169.5, 185.5, 193.5],
            'Sheriff': [157.5, 157.5, 164.5, 168.5, 171.5],
            'Social Services': [83, 84, 87, 90, 88],
            'Public Safety Comms': [17, 19, 20, 22, 22],
            'Regional Jail': [213, 213, 213, 215, 219],
        };

        // 14. Personnel Growth Chart
        new Chart(document.getElementById('deptPersonnelGrowthChart'), {
            type: 'line',
            data: {
                labels: personnelYearsExtended,
                datasets: [
                    {
                        label: 'Fire and Rescue',
                        data: personnelGrowth['Fire and Rescue'],
                        borderColor: colors.danger,
                        backgroundColor: colors.danger + '20',
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Sheriff',
                        data: personnelGrowth['Sheriff'],
                        borderColor: colors.primary,
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Regional Jail',
                        data: personnelGrowth['Regional Jail'],
                        borderColor: colors.purple,
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Social Services',
                        data: personnelGrowth['Social Services'],
                        borderColor: colors.success,
                        fill: false,
                        tension: 0.3,
                    },
                    {
                        label: 'Public Safety Comms',
                        data: personnelGrowth['Public Safety Comms'],
                        borderColor: colors.orange,
                        fill: false,
                        tension: 0.3,
                    },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.raw} FT positions`
                        }
                    }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Full-Time Positions' }
                    }
                }
            }
        });

        // 15. Public Safety Breakdown Chart (FY2025)
        const publicSafetyBreakdown = [
            { name: 'Fire & Rescue Personnel', value: 21.3 },
            { name: 'Sheriff Personnel', value: 19.5 },
            { name: 'Sheriff Operating', value: 3.1 },
            { name: 'Fire & Rescue Operating', value: 2.8 },
            { name: 'Public Safety Comms', value: 3.0 },
            { name: 'Volunteer Fire Depts', value: 1.5 },
            { name: 'Inspections', value: 1.7 },
            { name: 'Other Public Safety', value: 1.0 },
        ];

        new Chart(document.getElementById('publicSafetyBreakdownChart'), {
            type: 'doughnut',
            data: {
                labels: publicSafetyBreakdown.map(d => d.name),
                datasets: [{
                    data: publicSafetyBreakdown.map(d => d.value),
                    backgroundColor: [
                        colors.danger,
                        colors.primary,
                        colors.primaryLight,
                        '#fca5a5',
                        colors.orange,
                        colors.warning,
                        colors.teal,
                        colors.gray,
                    ],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => {
                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                const pct = ((ctx.raw / total) * 100).toFixed(1);
                                return `${ctx.label}: $${ctx.raw}M (${pct}%)`;
                            }
                        }
                    }
                }
            }
        });

        // 16. Fire & Rescue vs Sheriff Staffing Trend
        new Chart(document.getElementById('publicSafetyTrendChart'), {
            type: 'line',
            data: {
                labels: personnelYearsExtended,
                datasets: [
                    {
                        label: 'Fire and Rescue',
                        data: personnelGrowth['Fire and Rescue'],
                        borderColor: colors.danger,
                        backgroundColor: colors.danger + '30',
                        fill: true,
                        tension: 0.3,
                    },
                    {
                        label: 'Sheriff',
                        data: personnelGrowth['Sheriff'],
                        borderColor: colors.primary,
                        backgroundColor: colors.primary + '30',
                        fill: true,
                        tension: 0.3,
                    },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => {
                                const base = ctx.datasetIndex === 0 ? 153.5 : 157.5;
                                const growth = ((ctx.raw - base) / base * 100).toFixed(1);
                                return `${ctx.dataset.label}: ${ctx.raw} FT (+${growth}% from FY2022)`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        min: 140,
                        max: 210,
                        title: { display: true, text: 'Full-Time Positions' }
                    }
                }
            }
        });
    </script>
</body>
</html>
